# VectorIdiv 向量整数除法器验证需求与规划

## 1. 需求分析

### 1.1 模块概述
VectorIdiv是一个向量整数除法器，支持多种位宽的整数除法运算，采用SRT-4算法。该模块能够并行处理多个除法运算，支持有符号和无符号除法操作。

### 1.2 接口分析
根据VectorIdiv_top.sv文件，模块接口如下：

**输入信号：**
- `clock`: 时钟信号
- `reset`: 复位信号
- `io_sew[1:0]`: 元素宽度选择（SEW），控制操作数位宽
- `io_sign`: 符号位，0=无符号，1=有符号
- `io_dividend_v[127:0]`: 被除数向量
- `io_divisor_v[127:0]`: 除数向量
- `io_flush`: 刷新操作信号
- `io_div_in_valid`: 输入数据有效信号
- `io_div_out_ready`: 输出数据准备好接收信号

**输出信号：**
- `io_d_zero[15:0]`: 除零标志（每个元素对应一位）
- `io_div_in_ready`: 输入数据准备好接收信号
- `io_div_out_valid`: 输出数据有效信号
- `io_div_out_q_v[127:0]`: 商向量
- `io_div_out_rem_v[127:0]`: 余数向量

### 1.3 功能特性分析
1. **多精度支持**：支持8位、16位、32位、64位整数除法
2. **向量化处理**：可并行处理多个除法运算
3. **符号处理**：支持有符号和无符号除法
4. **流水线架构**：采用多级流水线提高吞吐率
5. **错误处理**：支持除零检测和刷新操作

## 2. 验证目标

### 2.1 验证重点
根据文档要求，验证主要针对除法相关功能，不需要验证波形、接口时序等其他非功能性特征。

### 2.2 需要验证的功能点
1. **基本除法运算功能**
   - 正常除法运算的正确性
   - 商和余数的计算准确性
   - 不同位宽下的运算结果

2. **边界条件处理**
   - 除零检测和处理
   - 最大值/最小值运算
   - 溢出情况处理

3. **符号处理**
   - 有符号除法运算
   - 无符号除法运算
   - 符号扩展的正确性

4. **向量化处理**
   - 并行运算的正确性
   - 不同元素同时运算的独立性
   - 向量中部分元素除零的处理

5. **控制信号处理**
   - 握手协议的正确性
   - 刷新操作的功能
   - 流水线控制

## 3. 风险点识别

### 3.1 算法实现风险
1. **SRT-4算法实现错误**：可能导致商或余数计算不准确
2. **除零处理不当**：可能导致系统异常或错误结果
3. **符号扩展错误**：有符号运算可能出现符号处理错误

### 3.2 边界条件风险
1. **最大值除以1**：可能产生最大商值
2. **最小值除以-1**（有符号）：可能导致溢出
3. **零除以任何数**：需要正确处理
4. **任何数除以零**：需要正确检测和处理

### 3.3 向量化处理风险
1. **元素间干扰**：向量中不同元素的运算可能相互影响
2. **部分除零处理**：向量中部分元素除零时的处理逻辑
3. **位宽混合处理**：不同位宽元素在同一向量中的处理

### 3.4 时序和协议风险
1. **握手协议错误**：valid/ready信号处理不当
2. **流水线冒险**：数据相关或控制相关可能导致错误
3. **刷新操作时机**：flush信号可能影响正在进行的运算

## 4. 验证计划

### 4.1 验证策略
采用**分层验证策略**，从简单到复杂，从单元到系统：

1. **基础功能验证**：验证单个元素的除法运算
2. **边界条件验证**：验证各种边界和特殊情况
3. **向量化验证**：验证多元素并行处理
4. **协议验证**：验证握手和控制信号
5. **压力测试**：大量随机测试确保稳定性

### 4.2 测试用例设计

#### 4.2.1 基础功能测试
- **test_basic_division_unsigned**: 无符号基本除法测试
- **test_basic_division_signed**: 有符号基本除法测试
- **test_different_sew**: 不同SEW配置测试
- **test_single_element**: 单元素向量测试

#### 4.2.2 边界条件测试
- **test_divide_by_zero**: 除零测试
- **test_zero_dividend**: 零作为被除数测试
- **test_maximum_values**: 最大值运算测试
- **test_minimum_values**: 最小值运算测试
- **test_overflow_cases**: 溢出情况测试

#### 4.2.3 向量化测试
- **test_parallel_operations**: 并行运算测试
- **test_mixed_values**: 混合数值测试
- **test_partial_div_zero**: 部分元素除零测试
- **test_vector_independence**: 向量元素独立性测试

#### 4.2.4 协议和控制测试
- **test_handshake_protocol**: 握手协议测试
- **test_flush_operation**: 刷新操作测试
- **test_pipeline_behavior**: 流水线行为测试
- **test_backpressure**: 反压测试

#### 4.2.5 压力测试
- **test_random_operations**: 随机运算测试
- **test_stress_operations**: 压力测试
- **test_long_sequences**: 长序列测试

### 4.3 验证环境搭建

#### 4.3.1 测试框架
- 使用pytest + toffee验证框架
- 采用顺序编程方法（适合中等复杂度DUT）
- 每个测试用例独立创建DUT实例

#### 4.3.2 覆盖率模型
创建功能覆盖率组：
- **FG-BASIC**: 基础除法功能
- **FG-BOUNDARY**: 边界条件处理
- **FG-VECTOR**: 向量化处理
- **FG-CONTROL**: 控制和协议功能

#### 4.3.3 参考模型
- 使用Python内置除法运算作为参考模型
- 对于边界条件，使用数学库进行精确计算
- 建立完整的期望结果计算函数

### 4.4 测试执行计划

#### 4.4.1 第一阶段：基础验证
1. 实现基础功能测试用例
2. 验证基本除法运算正确性
3. 确保测试环境稳定运行

#### 4.4.2 第二阶段：边界验证
1. 实现边界条件测试用例
2. 验证特殊情况处理
3. 分析发现的问题

#### 4.4.3 第三阶段：向量化验证
1. 实现向量化测试用例
2. 验证并行处理功能
3. 检查元素间独立性

#### 4.4.4 第四阶段：协议验证
1. 实现协议和控制测试
2. 验证握手协议正确性
3. 测试刷新和流水线功能

#### 4.4.5 第五阶段：全面验证
1. 执行压力测试
2. 运行完整回归测试
3. 分析覆盖率，确保充分验证

### 4.5 预期问题和处理策略

#### 4.5.1 可能的Bug类型
1. **计算错误**：商或余数计算不正确
2. **边界处理错误**：特殊值处理不当
3. **符号处理错误**：有符号运算问题
4. **时序问题**：流水线或握手协议问题
5. **向量化问题**：多元素处理错误

#### 4.5.2 Bug分析策略
1. **定位问题**：通过详细日志定位错误源
2. **根因分析**：基于源代码分析问题根源
3. **复现验证**：创建最小测试用例复现问题
4. **文档记录**：详细记录发现的问题和分析过程

#### 4.5.3 测试失败处理
1. **不修改DUT代码**：测试失败时不尝试修复VectorIdiv实现
2. **分析设计缺陷**：判断是否为设计缺陷并进行记录
3. **创建专门测试**：为发现的bug创建专门的测试用例
4. **持续跟踪**：跟踪所有发现的问题和缺陷

## 5. 验证完成标准

### 5.1 功能覆盖率目标
- 所有功能覆盖率组达到100%
- 所有检查点都被覆盖
- 边界条件100%覆盖

### 5.2 代码覆盖率目标
- 行覆盖率 ≥ 95%
- 分支覆盖率 ≥ 90%
- 状态机覆盖率 ≥ 90%

### 5.3 质量标准
- 所有测试用例通过
- 无已知严重bug
- 边界条件充分验证
- 向量化功能正确实现

## 6. 风险缓解措施

### 6.1 技术风险缓解
1. **参考模型验证**：确保参考模型的正确性
2. **分层验证**：从简单到复杂，逐步验证
3. **交叉验证**：使用不同方法验证同一功能
4. **代码审查**：定期审查测试代码质量

### 6.2 进度风险缓解
1. **并行开发**：同时开发多个测试用例
2. **优先级排序**：优先验证重要功能
3. **持续集成**：建立自动化测试流程
4. **定期评估**：定期评估验证进度和质量

## 7. 验证完成情况与回顾

- 覆盖率达成：FG/FC/CK三层功能覆盖率均为100%，新增随机除零/溢出用例已纳入回归。
- 需求满足度：1.1/1.2/1.3列出的接口与功能特性均有对应测试用例，未发现遗漏的需求条目。
- 已知局限：DUT核心RTL缺失（VectorIdiv.v为空），当前结论基于模型驱动的接口级验证，功能正确性需在RTL补齐后复测。
- 后续动作：待RTL实现后重复全量回归，并补充性能与长序列压力测试。

通过以上验证规划，我们将全面验证VectorIdiv模块的功能正确性，确保设计的可靠性、鲁棒性和正确性。