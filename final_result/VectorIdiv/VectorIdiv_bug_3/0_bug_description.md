# VectorIdiv_bug_3 æ·±åº¦åˆ†ææŠ¥å‘Š

## ğŸ“Š ç¼ºé™·æ¦‚è§ˆ

**æ–‡ä»¶ä½ç½®**: `bug_file/VectorIdiv_bug_3.v`
**Bug æ¨¡å—**: I8DivNr4 (8 ä½é™¤æ³•å™¨å­æ¨¡å—)
**Bug è¡Œå·**: ç¬¬ 33 è¡Œ (æ¨¡å—å®šä¹‰æ¥å£ç¼ºå¤±), ç¬¬ 5051 è¡Œ (é¡¶å±‚å®ä¾‹åŒ–æ¥å£ç¼ºå¤±)
**å½±å“èŒƒå›´**: 8 ä½æ•´æ•°é™¤æ³• (io_sew = 00)  
**ä¸¥é‡ç­‰çº§**: ğŸ”´ **é«˜å±** - å¯¼è‡´ 8 ä½æœ‰ç¬¦å·é™¤æ³•è¿ç®—ç»“æœå®Œå…¨é”™è¯¯  
**ç¼ºé™·ç±»å‹**: é€»è¾‘é˜‰å‰² - ç§»é™¤äº†ç¬¦å·å¤„ç†é€»è¾‘ï¼ˆSigned Logic Removalï¼‰

---

## ğŸ” ç¼ºé™·å®šä½

### ç¼ºé™·ä½ç½®

**Bug æ–‡ä»¶ (VectorIdiv_bug_3.v, ç¬¬ 33 è¡Œ)**:

```verilog
module I8DivNr4(
  input        clock,
  input        reset,
  // âŒ é”™è¯¯: ç¼ºå°‘ io_sign ä¿¡å·
  input  [7:0] io_dividend,
  input  [7:0] io_divisor,
  // ...
);
```

### ä¿¡å·æ˜ å°„å…³ç³»

é€šè¿‡åˆ†æä¿¡å·å®šä¹‰ï¼Œå‘ç° bug æ–‡ä»¶ä¸­çš„æ¨¡å—æ¥å£è¢«äººä¸ºåˆ å‡ï¼š

| åŸå§‹ä¿¡å·  | Bug æ–‡ä»¶çŠ¶æ€ | åŠŸèƒ½è¯´æ˜             |
| --------- | ------------ | -------------------- |
| `io_sign` | âŒ å·²åˆ é™¤    | æœ‰ç¬¦å·æ•°å¤„ç†æ§åˆ¶ä¿¡å· |

---

## ğŸ¯ æœ‰ç¬¦å·é™¤æ³•èƒŒæ™¯

### æœ‰ç¬¦å·æ•°å¤„ç†æœºåˆ¶

åœ¨è®¡ç®—æœºç®—æœ¯ä¸­ï¼Œæœ‰ç¬¦å·æ•°é™¤æ³•éœ€è¦ç‰¹æ®Šçš„å¤„ç†æœºåˆ¶ï¼š

1. **è¾“å…¥é¢„å¤„ç†**ï¼šå°†è¢«é™¤æ•°å’Œé™¤æ•°è½¬æ¢ä¸ºç»å¯¹å€¼è¿›è¡Œè®¡ç®—
2. **ç¬¦å·è®¡ç®—**ï¼šæ ¹æ®è¾“å…¥ç¬¦å·ç¡®å®šç»“æœç¬¦å·
3. **ç»“æœä¿®æ­£**ï¼šå¯¹è®¡ç®—ç»“æœè¿›è¡Œç¬¦å·ä¿®æ­£

### å…³é”®å¤„ç†é€»è¾‘

```verilog
// ç¬¦å·ä½è®¡ç®—
wire x_sign = io_sign & io_dividend[7];
wire d_sign = io_sign & io_divisor[7];

// è¾“å…¥å–ç»å¯¹å€¼
wire [7:0] abs_x = x_sign ? -io_dividend : io_dividend;
wire [7:0] abs_d = d_sign ? -io_divisor : io_divisor;

// ç»“æœç¬¦å·ä¿®æ­£
wire q_sign = x_sign ^ d_sign;
```

---

## âš ï¸ ç¼ºé™·å½±å“åˆ†æ

### 1. ç›´æ¥åæœ

**æœ‰ç¬¦å·é™¤æ³•åŠŸèƒ½å®Œå…¨å¤±æ•ˆ**ï¼š

- 8 ä½æœ‰ç¬¦å·é™¤æ³•æŒ‡ä»¤è¢«é”™è¯¯æ‰§è¡Œä¸ºæ— ç¬¦å·é™¤æ³•
- è´Ÿæ•°è¾“å…¥ä¼šäº§ç”Ÿå®Œå…¨é”™è¯¯çš„ç»“æœ

### 2. è¡Œä¸ºå¼‚å¸¸ç¤ºä¾‹

**æµ‹è¯•åœºæ™¯**ï¼š8 ä½æœ‰ç¬¦å·é™¤æ³•è¿ç®—

| è¾“å…¥ A (è¢«é™¤æ•°) | è¾“å…¥ B (é™¤æ•°) | æ“ä½œç±»å‹   | é¢„æœŸç»“æœ (Hex) | Bug ç»“æœ (Hex) | åå·®åˆ†æ                 |
| --------------- | ------------- | ---------- | -------------- | -------------- | ------------------------ |
| 0xF6 (-10)      | 0x02 (2)      | Signed Div | 0xFB (-5)      | 0x7B (123)     | å°†è´Ÿæ•°è¯¯åˆ¤ä¸ºå¤§æ­£æ•°       |
| 0x80 (-128)     | 0xFF (-1)     | Signed Div | 0x80 (-128)    | 0x00 (0)       | 128 / 255 = 0 (å®Œå…¨é”™è¯¯) |
| 0x0A (10)       | 0x02 (2)      | Signed Div | 0x05 (5)       | 0x05 (5)       | æ­£æ•°è¿ç®—æ°å·§æ­£ç¡®         |

**å…¸å‹é”™è¯¯é“¾**ï¼š

```
è¾“å…¥: -10 / 2 (0xF6 / 0x02)
  â†“
æ­£ç¡®å¤„ç†: |-10| / |2| = 10 / 2 = 5
  â†“
ç¬¦å·ä¿®æ­£: ç»“æœç¬¦å· = è´Ÿ/æ­£ = è´Ÿ â†’ -5 (0xFB)
  â†“
é”™è¯¯å¤„ç†: ç›´æ¥ä½¿ç”¨ 0xF6 / 0x02 = 246 / 2 = 123 (0x7B)
  â†“
ç»“æœå®Œå…¨ä¸åŒ
```

### 3. ç³»ç»Ÿçº§é£é™©

#### ğŸ”¥ åŠŸèƒ½å®Œæ•´æ€§é—®é¢˜

- **æŒ‡ä»¤é›†ä¸å®Œæ•´**ï¼š8 ä½æœ‰ç¬¦å·é™¤æ³•åŠŸèƒ½ç¼ºå¤±
- **æ•°æ®ç±»å‹æ”¯æŒä¸å…¨**ï¼šå½±å“å¯¹è´Ÿæ•°çš„æ­£ç¡®å¤„ç†
- **å…¼å®¹æ€§é—®é¢˜**ï¼šä¸æ ‡å‡† RISC-V å‘é‡æ‰©å±•ä¸å…¼å®¹

#### ğŸ’¥ åº”ç”¨å±‚å½±å“

```mermaid
graph TD
    A[VectorIdivæ¨¡å—] --> B[I8DivNr4å­æ¨¡å—]
    B --> C[8ä½æœ‰ç¬¦å·é™¤æ³•]
    C --> D[ç»“æœé”™è¯¯]
    D --> E[ä¸Šå±‚åº”ç”¨å¼‚å¸¸]
```

#### ğŸ›¡ï¸ æµ‹è¯•è¦†ç›–ç›²åŒº

- **æµ‹è¯•é—æ¼é£é™©**ï¼šå¦‚æœæµ‹è¯•åªè¦†ç›–æ­£æ•°æˆ–æ— ç¬¦å·æ•°ï¼Œè¯¥é”™è¯¯å¯èƒ½é•¿æœŸæœªè¢«å‘ç°
- **è¾¹ç•Œæ¡ä»¶å¤±æ•ˆ**ï¼šè´Ÿæ•°è¾¹ç•Œæ¡ä»¶å¤„ç†å®Œå…¨é”™è¯¯

---

## ğŸ”¬ ä¿¡å·æº¯æºåˆ†æ

### ä¿¡å·å®šä¹‰é“¾è·¯è¿½è¸ª

**io_sign çš„å®Œæ•´ä½¿ç”¨è·¯å¾„**ï¼š

```verilog
// ç¬¬33è¡Œ - æ¨¡å—æ¥å£å®šä¹‰ï¼ˆåŸå§‹æ–‡ä»¶ï¼‰
input io_sign,

// å†…éƒ¨ç¬¦å·ä½è®¡ç®—
wire x_sign = io_sign & io_dividend[7];
wire d_sign = io_sign & io_divisor[7];

// è¾“å…¥å–ç»å¯¹å€¼
wire [7:0] abs_x = x_sign ? 8'(8'h0 - io_dividend) : io_dividend;
wire [7:0] abs_d = d_sign ? 8'(8'h0 - io_divisor) : io_divisor;

// ç»“æœç¬¦å·è®¡ç®—
wire q_sign = x_sign ^ d_sign;
```

**ä¾èµ–ä¿¡å·è§£æ**ï¼š

| ä¿¡å·å    | å«ä¹‰           | æ•°æ®æ¥æº         |
| --------- | -------------- | ---------------- |
| `io_sign` | æœ‰ç¬¦å·å¤„ç†ä½¿èƒ½ | é¡¶å±‚æ¨¡å—æ§åˆ¶ä¿¡å· |
| `x_sign`  | è¢«é™¤æ•°ç¬¦å·ä½   | å†…éƒ¨è®¡ç®—         |
| `d_sign`  | é™¤æ•°ç¬¦å·ä½     | å†…éƒ¨è®¡ç®—         |
| `q_sign`  | å•†ç»“æœç¬¦å·ä½   | å†…éƒ¨è®¡ç®—         |

---

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒä¿®å¤

**1. æ¨¡å—æ¥å£ä¿®å¤**ï¼š

```verilog
// ä¿®å¤å‰
module I8DivNr4(
  input        clock,
  input        reset,
  // âŒ ç¼ºå°‘ io_sign è¾“å…¥
  input  [7:0] io_dividend,
  input  [7:0] io_divisor,
  // ...
);

// ä¿®å¤å
module I8DivNr4(
  input        clock,
  input        reset,
  input        io_sign,  // âœ… æ¢å¤ç¬¦å·ä½è¾“å…¥
  input  [7:0] io_dividend,
  input  [7:0] io_divisor,
  // ...
);
```

**2. é¡¶å±‚å®ä¾‹åŒ–ä¿®å¤**ï¼š

```verilog
// ä¿®å¤å‰
I8DivNr4 OjW5x8O0URkVhZ (
  .clock            (clock),
  .reset            (reset),
  // âŒ ç¼ºå°‘ .io_sign è¿æ¥
  .io_dividend      (Vs5R3[7:0]),
  // ...
);

// ä¿®å¤å
I8DivNr4 OjW5x8O0URkVhZ (
  .clock            (clock),
  .reset            (reset),
  .io_sign          (Gv2lX9Ey), // âœ… è¿æ¥é¡¶å±‚ç¬¦å·å¯„å­˜å™¨ Gv2lX9Ey (å³ io_sign)
  .io_dividend      (Vs5R3[7:0]),
  // ...
);
```

**3. å†…éƒ¨é€»è¾‘ä¿®å¤**ï¼š

```verilog
// ä¿®å¤å‰ - ç¼ºå°‘ç¬¦å·å¤„ç†é€»è¾‘
jD3K2ZKd6Uyvde <= F7OngeCv[1] ? io_dividend : vbzRibWQSL9v2xH0cpGc;

// ä¿®å¤å - æ¢å¤å®Œæ•´ç¬¦å·å¤„ç†é€»è¾‘
wire x_sign = io_sign & io_dividend[7];
wire d_sign = io_sign & io_divisor[7];
wire [7:0] abs_x = x_sign ? 8'(8'h0 - io_dividend) : io_dividend;
wire [7:0] abs_d = d_sign ? 8'(8'h0 - io_divisor) : io_divisor;
jD3K2ZKd6Uyvde <= F7OngeCv[1] ? abs_x : vbzRibWQSL9v2xH0cpGc;
```

### éªŒè¯è¦ç‚¹

#### æµ‹è¯•æ–¹æ³•

- è¿è¡Œ `2_test_cases.py` æ„å»ºæœ€å°å¤ç°ï¼šè„šæœ¬å®ä¾‹åŒ– `DUTVectorIdiv`ã€æ‰§è¡Œä¸¤æ‹å¤ä½ã€é…ç½® `io_sew=0` (I8) ä¸”æ‹‰é«˜ `io_sign`ï¼Œç¡®ä¿è¿›å…¥ 8 ä½æœ‰ç¬¦å·è·¯å¾„ã€‚
- æ¿€æ´»æ¡æ‰‹ï¼šæ‹‰é«˜ `io_div_out_ready`ï¼Œå°† `io_dividend_v` å†™å…¥ `0xF6` (âˆ’10)ã€`io_divisor_v` å†™å…¥ `0x02`ï¼ŒåŒæ—¶ç½® `io_div_in_valid=1` å‘èµ·ä¸€æ¬¡é™¤æ³•è¯·æ±‚ï¼Œç„¶ååœ¨ 5 ä¸ªå‘¨æœŸåæ‹‰ä½ã€‚
- è½®è¯¢ `io_div_out_valid`ï¼Œæ•è·è¾“å‡ºå‘é‡å¹¶å±è”½é«˜ä½ï¼Œä»…æ¯”å¯¹ lane0ï¼šé¢„æœŸå•† `0xFB`ã€ä½™æ•° `0x00`ï¼›è‹¥å‡ºç° `0x7B` ç­‰ç»“æœå³è¯´æ˜ç¬¦å·é€»è¾‘ç¼ºå¤±ã€‚
- å¯æ‰©å±•éªŒè¯ï¼šè°ƒæ•´è¾“å…¥ä¸ºå…¶ä»–è´Ÿæ•°å¯¹æˆ–åˆ‡æ¢ `io_sign=0` éªŒè¯æ— ç¬¦å·è·¯å¾„ä»å·¥ä½œï¼Œä»¥åŒºåˆ†ç¬¦å·é€»è¾‘é—®é¢˜ä¸æ•°æ®è·¯å¾„é—®é¢˜ã€‚

#### å›å½’æµ‹è¯•èŒƒå›´

- âœ… 8 ä½æœ‰ç¬¦å·é™¤æ³•å®Œæ•´æµ‹è¯•
- âœ… 8 ä½æ— ç¬¦å·é™¤æ³•å›å½’æµ‹è¯•
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆæœ€å°/æœ€å¤§å€¼ï¼‰
- âœ… 16/32/64 ä½é™¤æ³•ä¸å—å½±å“éªŒè¯

---

## ğŸ“š RISC-V å‘é‡æ‰©å±•å‚è€ƒ

**ç›¸å…³æ¡æ¬¾**ï¼š

- **Vector Extension v1.0**: å‘é‡æ•´æ•°é™¤æ³•æŒ‡ä»¤å®šä¹‰
- **Section 15.2**: æœ‰ç¬¦å·ä¸æ— ç¬¦å·æ•´æ•°é™¤æ³•å¤„ç†è§„èŒƒ

**æ ‡å‡†è¦æ±‚**ï¼š

- æ”¯æŒæœ‰ç¬¦å·å’Œæ— ç¬¦å·ä¸¤ç§æ¨¡å¼
- æœ‰ç¬¦å·é™¤æ³•éœ€æ­£ç¡®å¤„ç†è´Ÿæ•°è¾“å…¥å’Œç»“æœ

---

## âœ… ä¿®å¤éªŒè¯æ¸…å•

- [ ] ä»£ç å·²ä¿®æ”¹: æ¢å¤ I8DivNr4 æ¨¡å—çš„ io_sign ç«¯å£
- [ ] é€»è¾‘å·²æ¢å¤: é‡æ–°å®ç°æœ‰ç¬¦å·æ•°å¤„ç†é€»è¾‘
- [ ] ä»¿çœŸé€šè¿‡: 8 ä½æœ‰ç¬¦å·é™¤æ³•æµ‹è¯•å‘é‡
- [ ] å›å½’æµ‹è¯•: å®Œæ•´é™¤æ³•åŠŸèƒ½æµ‹è¯•å¥—ä»¶
- [ ] æ ‡å‡†ç¬¦åˆæ€§: RISC-V å‘é‡æ‰©å±•è§„èŒƒéªŒè¯
- [ ] å½¢å¼éªŒè¯: ç­‰ä»·æ€§æ£€æŸ¥ (å¦‚æœé€‚ç”¨)
- [ ] æ–‡æ¡£æ›´æ–°: Release Note ä¸­è®°å½•æ­¤ä¿®å¤

---

## ğŸ“ ç›¸å…³å½±å“æ¨¡å—

**ç›´æ¥å½±å“**ï¼š

- âœ… I8DivNr4 æ¨¡å— (ä¸»æ¨¡å—)
- âœ… VectorIdiv é¡¶å±‚æ¨¡å—å®ä¾‹åŒ–

**é—´æ¥å½±å“**ï¼š

- âš ï¸ 8 ä½å‘é‡é™¤æ³•æŒ‡ä»¤å®ç°
- âš ï¸ éœ€è¦ç¬¦å·å¤„ç†çš„æ•°å­¦åº“å‡½æ•°
- âš ï¸ ç¼–è¯‘å™¨å¯¹æœ‰ç¬¦å·é™¤æ³•çš„ä¼˜åŒ–

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-05  
