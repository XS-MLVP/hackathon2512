# VectorFloatAdder 验证需求与计划

## 需求分析

### DUT整体功能描述
VectorFloatAdder是一个向量浮点加法器，支持多种浮点格式（半精度f16、单精度f32、双精度f64）的加法和减法运算，并支持精度转换、归约操作和折叠操作等高级功能。

### 核心功能特性
1. **向量多精度并行计算**：
   - f16格式：64位输入分为4个16位部分，并行执行4个运算
   - f32格式：64位输入分为2个32位部分，并行执行2个运算
   - f64格式：整个64位用于1个运算
   
2. **混合精度计算**：支持f64=f64+f32、f32=f32+f16等混合精度运算

3. **操作类型**：支持27种操作码，包括加法、减法、比较、移动、归约等

4. **舍入模式**：支持5种IEEE754标准舍入模式

5. **异常处理**：支持NaN、无穷大等特殊值处理，并生成相应的标志位

## 验证目标

需要测试的主要功能：
1. 基本算术运算（加法、减法）
2. 比较运算（等于、不等于、大于、小于等）
3. 特殊值处理（NaN、无穷大、零）
4. 不同精度格式的运算
5. 混合精度运算
6. 不同舍入模式下的运算
7. 边界条件和异常情况处理
8. 标志位生成（无效操作、上溢、下溢、不精确）

## 风险点识别

### 高风险区域
1. **浮点特殊值处理**：NaN、无穷大的传播规则复杂，容易出错
2. **混合精度运算**：格式转换过程中的精度损失和舍入
3. **边界条件**：最大值、最小值、接近零的数值处理
4. **异常标志生成**：各种异常情况下的标志位组合
5. **不同舍入模式**：5种舍入模式下的结果差异

### 边界条件
1. 零值运算（+0、-0）
2. 无穷大运算（+∞、-∞）
3. NaN值运算（不同类型的NaN）
4. 最大/最小值运算
5. 溢出/下溢情况

## 验证计划

### 阶段1：基础功能验证
1. **基本算术运算测试**
   - 测试fadd、fsub操作在f16、f32、f64格式下的基本功能
   - 使用典型数值验证计算正确性
   - 验证向量并行计算结果

2. **比较运算测试**
   - 测试所有比较操作（feq、fne、flt、fle、fgt、fge等）
   - 验证比较结果的正确性
   - 测试安静版本比较操作

### 阶段2：特殊值处理验证
1. **特殊值基本测试**
   - 测试NaN值的输入和传播
   - 测试无穷大值的运算
   - 测试零值的运算（+0和-0的区别）

2. **特殊值组合测试**
   - 测试特殊值与正常值的运算
   - 测试特殊值之间的运算
   - 验证特殊值的优先级处理

### 阶段3：精度和舍入验证
1. **不同精度格式测试**
   - 测试f16、f32、f64格式的运算
   - 验证精度转换的正确性
   - 测试混合精度运算

2. **舍入模式测试**
   - 测试5种舍入模式（RNE、RTZ、RDN、RUP、RMM）
   - 使用边界值验证舍入效果
   - 测试舍入对标志位的影响

### 阶段4：边界条件和异常验证
1. **边界条件测试**
   - 测试最大值、最小值运算
   - 测试接近零的数值运算
   - 测试数值范围边界

2. **异常处理测试**
   - 测试上溢情况及标志位
   - 测试下溢情况及标志位
   - 测试无效操作及标志位
   - 测试不精确运算及标志位

### 阶段5：高级功能验证
1. **归约操作测试**
   - 测试fsum_ure、fsum_ore等归约操作
   - 验证有序和无约束归约的区别

2. **其他操作测试**
   - 测试fmin、fmax、fmerge等操作
   - 测试移动操作（fmv_f_s、fmv_s_f）
   - 测试符号操作（fsgnj系列）

### 阶段6：综合验证
1. **随机测试**
   - 生成大量随机测试用例
   - 覆盖各种操作和格式的组合
   - 提高验证覆盖率

2. **回归测试**
   - 建立完整的回归测试套件
   - 确保所有功能点都有覆盖
   - 验证修复bug后的功能完整性

## 测试策略

### 测试用例设计原则
1. **系统性**：按照功能模块系统设计测试用例
2. **完整性**：覆盖所有操作码和功能点
3. **针对性**：针对高风险区域设计专门测试
4. **随机性**：使用随机测试发现未知问题

### 测试数据生成
1. **定向测试数据**：针对特定功能点的精心设计数据
2. **边界测试数据**：最大值、最小值、特殊值等
3. **随机测试数据**：大量随机生成的测试数据
4. **异常测试数据**：专门针对异常情况的测试数据

### 验证方法
1. **功能仿真**：使用Python测试框架进行功能验证
2. **覆盖率驱动**：基于功能覆盖率指导测试用例生成
3. **回归测试**：建立自动化回归测试流程
4. **Bug分析**：对发现的bug进行详细分析和跟踪

## 预期成果

1. **完整的测试套件**：覆盖所有功能点的测试用例
2. **高覆盖率**：功能覆盖率和代码覆盖率达标
3. **Bug报告**：发现的所有设计问题的详细分析报告
4. **验证报告**：完整的验证过程和结果总结

## 注意事项

1. VectorFloatAdder中可能有隐藏bug，测试失败时不要尝试修复VectorFloatAdder的实现
2. 测试失败时应分析是否为设计缺陷并进行详细记录
3. 需要基于源码（VectorFloatAdder.v）进行bug分析
4. 所有文档和注释都用中文编写
5. 验证过程中发现的bug需要详细描述表现和功能与spec不一致的地方